<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MDM SYSTEM 'MDM.DTD'>

<!--
        <h2>Introduction</h2>
        This MDM defines the interface for stand-alone (possibly external) tasks managed by UxAS
-->

<MDM>
    <SeriesName>UXTASK</SeriesName>
    <Namespace>uxas/messages/task</Namespace>
    <Version>8</Version>
    
    <EnumList>
    </EnumList>
    
    <StructList>
        
        <!-- Representation of the assignment of entities to a task -->
        <Struct Name="TaskAssignment">
            <!-- Task ID -->
            <Field Name="TaskID" Type="int64" />
            <!-- Option ID that was selected for this task -->
            <Field Name="OptionID" Type="int64" />
            <!-- Vehicle that is assigned to this task -->
            <Field Name="AssignedVehicle" Type="int64" />
            <!-- Time before which this task cannot begin -->
            <Field Name="TimeThreshold" Type="int64" Units="milliseconds since 1 Jan 1970" />
            <!-- Time that this task is assigned to be completed. -->
            <Field Name="TimeTaskCompleted" Type="int64" Units="milliseconds since 1 Jan 1970" />
        </Struct>
        
        <!-- Place a task in a 'paused' state where it no longer sends commands to any entities -->
        <Struct Name="TaskPause">
            <!-- Task ID -->
            <Field Name="TaskID" Type="int64" />
        </Struct>
        
        <!-- Resumes execution of a task from it's paused state -->
        <Struct Name="TaskResume">
            <!-- Task ID -->
            <Field Name="TaskID" Type="int64" />
            <!-- Instead of resuming from paused task state, re-start the complete task -->
            <Field Name="RestartCompletely" Type="bool" Default="false" />
            <!-- Instead of resuming from paused task state with the previously assigned entities, resume task with new assignment options. Only used when not null. -->
            <Field Name="ReAssign" Type="TaskAssignment" Default="null" Optional="true" />
        </Struct>
        
        <!-- Reports the progress of the task -->
        <Struct Name="TaskProgress">
            <!-- Response ID that matches the task progress request -->
            <Field Name="ResponseID" Type="int64" />
            <!-- Task ID -->
            <Field Name="TaskID" Type="int64" />
            <!-- Percentage of progress on task -->
            <Field Name="PercentComplete" Type="real32" />
            <!-- Entities that are working this task -->
            <Field Name="EntitiesEngaged" Type="int64[]" MaxArrayLength="16" />
        </Struct>
        
        <!-- Optional task progress query -->
        <Struct Name="TaskProgressRequest">
            <!-- Task progress request ID for properly matching corresponding response -->
            <Field Name="RequestID" Type="int64" />
            <!-- Task ID to report current progress -->
            <Field Name="TaskID" Type="int64" />
        </Struct>
        
        <!-- Task initialized message indicating that the corresponding task service is available for use in automation requests -->
        <Struct Name="TaskInitialized" >
            <!-- Task ID is initialized and ready for use in automation requests -->
            <Field Name="TaskID" Type="int64" />
        </Struct>

        <!-- Task Active message. Sent when task becomes active -->
        <Struct Name="TaskActive" >
            <!-- Task ID that was just activated -->
            <Field Name="TaskID" Type="int64" />
            <!-- Entity ID that activated the task -->
            <Field Name="EntityID" Type="int64" />
            <!-- Time that this task was activated. -->
            <Field Name="TimeTaskActivated" Type="int64" Units="milliseconds since 1 Jan 1970" />
        </Struct>

        <!-- Task complete message -->
        <Struct Name="TaskComplete" >
            <!-- Task ID that was just completed -->
            <Field Name="TaskID" Type="int64" />
            <!-- Entity IDs that completed the task -->
            <Field Name="EntitiesInvolved" Type="int64[]" MaxArrayLength="16" />
            <!-- Time that this task was completed. -->
            <Field Name="TimeTaskCompleted" Type="int64" Units="milliseconds since 1 Jan 1970" />
        </Struct>
        
        <!-- Task cancel message -->
        <Struct Name="CancelTask" >
            <!-- List of vehicle IDs that are directed to cancel tasks. If empty, all vehicles currently on a listed task will be directed to cancel. -->
            <Field Name="Vehicles" Type="int64[]" MaxArrayLength="16" />
            <!-- Task ID(s) to be removed from task lists of indicated vehicles. If empty, then only the current task is removed. -->
            <Field Name="CanceledTasks" Type="int64[]" MaxArrayLength="16" />
        </Struct>
        
    </StructList>
</MDM>
