<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MDM SYSTEM 'MDM.DTD'>

<!--
        <h2>Introduction</h2>
        This MDM defines the interface for stand-alone (possibly external) tasks managed by UxAS
-->

<MDM>
    <SeriesName>UXTASK</SeriesName>
    <Namespace>uxas/messages/task</Namespace>
    <Version>8</Version>
    
    <EnumList>
    </EnumList>
    
    <StructList>
        
        <!-- Single task option cost for a particular vehicle -->
	<Struct Name="TaskOptionCost" >
            <!-- Corresponding Vehicle ID -->
            <Field Name="VehicleID" Type="int64" />
            <!-- Initial task ID (if zero, corresponds to current vehicle location) -->
            <Field Name="IntialTaskID" Type="int64" />
            <!-- Initial task option -->
            <Field Name="IntialTaskOption" Type="int64" />
            <!-- Destination task ID -->
            <Field Name="DestinationTaskID" Type="int64" />
            <!-- Destination task option -->
            <Field Name="DestinationTaskOption" Type="int64" />
            <!-- Timing corresponding to travel between ('InitialTask' using 'InitialTaskOption')
            and ('DestinationTask' using 'DestinationTaskOption'). If time is less than zero,
            no feasible path exists between tasks. -->
            <Field Name="TimeToGo" Type="int64" Units="milliseconds" />
        </Struct>
        
        <!-- Representation of the assignment of entities to a task -->
        <Struct Name="TaskAssignment">
            <!-- Task ID -->
            <Field Name="TaskID" Type="int64" />
            <!-- Option ID that was selected for this task -->
            <Field Name="OptionID" Type="int64" />
            <!-- Vehicle that is assigned to this task -->
            <Field Name="AssignedVehicle" Type="int64" />
            <!-- Time before which this task cannot begin -->
            <Field Name="TimeThreshold" Type="int64" Units="milliseconds since 1 Jan 1970" />
            <!-- Time that this task is assigned to be completed. -->
            <Field Name="TimeTaskCompleted" Type="int64" Units="milliseconds since 1 Jan 1970" />
        </Struct>
        
        <!-- A completed assignment consisting of an <b>ordered</b> list of tasks -->
        <Struct Name="TaskAssignmentSummary">
            <!-- ID that matches this summary with the appropriate unique automation request -->
            <Field Name="CorrespondingAutomationRequestID" Type="int64" />
            <!-- Operating region which was considered during this assignment -->
            <Field Name="OperatingRegion" Type="int64" />
            <!-- Ordered list of tasks to be completed -->
            <Field Name="TaskList" Type="TaskAssignment[]" MaxArrayLength="256" />
        </Struct>

        <!-- Start/end locations and headings and cost for implementing the task from this configuration -->
        <Struct Name="TaskOption">
            <!-- Task ID -->
            <Field Name="TaskID" Type="int64" />
            <!-- ID for this option -->
            <Field Name="OptionID" Type="int64" />
            <!-- Eligible entities for completing this option with identical cost to complete. If list is empty, then all vehicles are assumed to be eligible. -->
            <Field Name="EligibleEntities" Type="int64[]" MaxArrayLength="16" />
            <!-- Cost to complete option in terms of time (given in milliseconds) -->
            <Field Name="Cost" Type="int64" Units="milliseconds"/>
            <!-- Start heading entering the option -->
            <Field Name="StartHeading" Type="real32" Units="degrees" />
            <!-- Ending heading for this option -->
            <Field Name="EndHeading" Type="real32" Units="degrees" />
        </Struct>
        
        <!-- Place a task in a 'paused' state where it no longer sends commands to any entities -->
        <Struct Name="TaskPause">
            <!-- Task ID -->
            <Field Name="TaskID" Type="int64" />
        </Struct>
        
        <!-- Resumes execution of a task from it's paused state -->
        <Struct Name="TaskResume">
            <!-- Task ID -->
            <Field Name="TaskID" Type="int64" />
            <!-- Instead of resuming from paused task state, re-start the complete task -->
            <Field Name="RestartCompletely" Type="bool" Default="false" />
            <!-- Instead of resuming from paused task state with the previously assigned entities, resume task with new assignment options. Only used when not null. -->
            <Field Name="ReAssign" Type="TaskAssignment" Default="null" Optional="true" />
        </Struct>
        
        <!-- Reports the progress of the task -->
        <Struct Name="TaskProgress">
            <!-- Response ID that matches the task progress request -->
            <Field Name="ResponseID" Type="int64" />
            <!-- Task ID -->
            <Field Name="TaskID" Type="int64" />
            <!-- Percentage of progress on task -->
            <Field Name="PercentComplete" Type="real32" />
            <!-- Entities that are working this task -->
            <Field Name="EntitiesEngaged" Type="int64[]" MaxArrayLength="16" />
        </Struct>
        
        <!-- Optional task progress query -->
        <Struct Name="TaskProgressRequest">
            <!-- Task progress request ID for properly matching corresponding response -->
            <Field Name="RequestID" Type="int64" />
            <!-- Task ID to report current progress -->
            <Field Name="TaskID" Type="int64" />
        </Struct>
        
        <!-- Task initialized message indicating that the corresponding task service is available for use in automation requests -->
        <Struct Name="TaskInitialized" >
            <!-- Task ID is initialized and ready for use in automation requests -->
            <Field Name="TaskID" Type="int64" />
        </Struct>

        <!-- Task Active message. Sent when task becomes active -->
        <Struct Name="TaskActive" >
            <!-- Task ID that was just activated -->
            <Field Name="TaskID" Type="int64" />
            <!-- Entity ID that activated the task -->
            <Field Name="EntityID" Type="int64" />
            <!-- Time that this task was activated. -->
            <Field Name="TimeTaskActivated" Type="int64" Units="milliseconds since 1 Jan 1970" />
        </Struct>

        <!-- Task complete message -->
        <Struct Name="TaskComplete" >
            <!-- Task ID that was just completed -->
            <Field Name="TaskID" Type="int64" />
            <!-- Entity IDs that completed the task -->
            <Field Name="EntitiesInvolved" Type="int64[]" MaxArrayLength="16" />
            <!-- Time that this task was completed. -->
            <Field Name="TimeTaskCompleted" Type="int64" Units="milliseconds since 1 Jan 1970" />
        </Struct>
        
        <!-- Task cancel message -->
        <Struct Name="CancelTask" >
            <!-- List of vehicle IDs that are directed to cancel tasks. If empty, all vehicles currently on a listed task will be directed to cancel. -->
            <Field Name="Vehicles" Type="int64[]" MaxArrayLength="16" />
            <!-- Task ID(s) to be removed from task lists of indicated vehicles. If empty, then only the current task is removed. -->
            <Field Name="CanceledTasks" Type="int64[]" MaxArrayLength="16" />
        </Struct>
        
    </StructList>
</MDM>
